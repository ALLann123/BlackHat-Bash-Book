#!/bin/bash

# Check if at least one IP address is provided
if [ "$#" -lt 1 ]; then
    echo "Usage: $0 <IP_ADDRESS_1> [IP_ADDRESS_2] ..."
    exit 1
fi

# File to store vulnerability scan results
OUTPUT_FILE="vulnerability_scan_results.txt"

# Clear the output file
echo "Vulnerability Scan Results - $(date)" > "$OUTPUT_FILE"
echo "=========================================" >> "$OUTPUT_FILE"

# Loop through all provided IP addresses
for ip in "$@"; do
    echo "Scanning IP: $ip"
    echo "-----------------------------------------"

    # Run nmap to detect open ports and services
    nmap_output=$(nmap -sV "$ip")
    echo "$nmap_output"
    echo

    # Check if port 21 (FTP) is open
    if echo "$nmap_output" | grep -q "21/tcp.*open"; then
        echo "FTP port detected on $ip. Running vulnerability scan..."
        
        # Run Nmap's vulnerability scripts for FTP
        nmap --script ftp-vuln* "$ip" -p 21 -oN ftp_vuln_scan.txt

        # Append the results to the output file
        echo "Results for $ip (FTP Vulnerability Scan):" >> "$OUTPUT_FILE"
        cat ftp_vuln_scan.txt >> "$OUTPUT_FILE"
        echo "-----------------------------------------" >> "$OUTPUT_FILE"

        # Clean up temporary file
        rm ftp_vuln_scan.txt
    else
        echo "No FTP port detected on $ip. Skipping vulnerability scan."
    fi

    echo "-----------------------------------------"
    echo
done

echo "Vulnerability scanning complete. Results saved to $OUTPUT_FILE."

