#!/usr/bin/env bash

file="${1}"
output_folder="${2}"

if [[ ! -s "${file}" ]]; then
    echo "[+]Invalid File"
    exit 1
fi

if [[ -z "$output_folder" ]]; then
    output_folder="data"
fi

while read -r line; do
    # Remove white spaces in each line
    url=$(echo "${line}" | xargs)

    # Check if the string is non-empty
    if [[ -n "${url}" ]]; then
        echo "[+]Testing for directory indexing..."
        # Use curl to make an HTTP GET request and follow any HTTP redirects
        if curl -L -s "${url}" | grep -q -e "Index of/" -e "[PARENTDIR]"; then
            echo -e "\t -!- Found Directory indexing page at ${url}"
            echo -e "\t -!- Downloading to the \"${output_folder}\" folder..."
            mkdir -p "${output_folder}"
            wget -q -r -np -R "index.html*" "${url}" -P "${output_folder}"
        fi
    fi
done < "${file}"
